
name: hish-rag

services:
  qdrant:
    image: qdrant/qdrant:latest
    restart: unless-stopped
    environment:
      QDRANT__SERVICE__GRPC_PORT: 6334
    ports:
      - "6333:6333"
      - "6334:6334"
    volumes:
      - ./.data/qdrant:/qdrant/storage
    healthcheck:
      test: ["CMD-SHELL", "timeout 5 bash -c 'cat < /dev/null > /dev/tcp/localhost/6333' || exit 1"]
      interval: 5s
      timeout: 10s
      retries: 6
      start_period: 5s

  # LlamaIndex-Compatible Qdrant MCP: main CRUD server
  mcp-qdrant-llamaindex:
    build:
      context: ./mcp
      dockerfile: Dockerfile.llamaindex
    depends_on:
      qdrant:
        condition: service_healthy
    env_file:
      - ./env.mcp
    environment:
      - QDRANT_READ_ONLY=false
    command: ["qdrant-llamaindex-mcp-server", "--transport", "stdio"]
    profiles: ["stdio"]  # invoked interactively



  # Note: Indexing is now done host-based for better performance
  # Container-based indexing services have been removed in favor of host-based indexing
  # Use 'make index' or 'python3 scripts/host-indexer.py' for indexing
  # 
  # For testing, use: cd rag/indexer && python -m pytest tests/ -v
